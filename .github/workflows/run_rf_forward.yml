name: Run RF Forward (Manual Only)

on:
  workflow_dispatch:   # üëà ch·ªâ ch·∫°y th·ªß c√¥ng

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ L·∫•y code trong repo
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ C√†i Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      # 3Ô∏è‚É£ T·∫£i file d·ªØ li·ªáu m·∫´u v·ªÅ
      - name: Download sample dataset
        run: |
          mkdir -p data
          wget -O data/data2.csv "https://github.com/thanhnha01/NCKH_ANHHONG/releases/download/v1.0/data2.csv"

      # 4Ô∏è‚É£ C√†i c√°c th∆∞ vi·ªán c·∫ßn thi·∫øt
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy scikit-learn imbalanced-learn matplotlib

      # 5Ô∏è‚É£ Ch·∫°y script ch√≠nh
      - name: Run RF Forward training
        run: |
          python rf_forward_train.py

      # 6Ô∏è‚É£ N√©n th∆∞ m·ª•c results th√†nh file zip
      - name: Zip results folder
        run: |
          zip -r results_${{ github.run_number }}.zip results/

      # 7Ô∏è‚É£ T·∫°o Release m·ªõi v√† upload file zip
      - name: Create GitHub Release and Upload Results
        uses: softprops/action-gh-release@v1
        with:
          tag_name: run-${{ github.run_number }}
          name: "RF Forward Results #${{ github.run_number }}"
          body: |
            ‚úÖ K·∫øt qu·∫£ hu·∫•n luy·ªán Random Forest + SMOTETomek + Calibration (Sigmoid)
            - D·ªØ li·ªáu: data2.csv t·ª´ https://github.com/thanhnha01/NCKH_ANHHONG/releases/tag/v1.0
            - Threshold ch·ªçn theo Recall‚â•0.8
          files: results_${{ github.run_number }}.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
