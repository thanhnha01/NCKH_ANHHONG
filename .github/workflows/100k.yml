name: DATA-PHASE3

on:
  workflow_dispatch:  # Ch·∫°y th·ªß c√¥ng t·ª´ tab "Actions"

permissions:
  contents: write   # Cho ph√©p t·∫°o tag & release

jobs:
  run_rf_forward:
    runs-on: ubuntu-latest
    timeout-minutes: 60  # Gi·ªõi h·∫°n th·ªùi gian tr√°nh treo

    steps:
      # 1Ô∏è‚É£ L·∫•y m√£ ngu·ªìn
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ C√†i m√¥i tr∆∞·ªùng Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3Ô∏è‚É£ C√†i th∆∞ vi·ªán c·∫ßn thi·∫øt
      - name: Install dependencies
        run: |
          pip install -U pip
          pip install numpy pandas scikit-learn imbalanced-learn matplotlib argparse

      # 4Ô∏è‚É£ T·∫£i d·ªØ li·ªáu m·∫´u
      - name: Download dataset
        run: |
          mkdir -p data
          wget -O data/data2.csv https://github.com/thanhnha01/NCKH_ANHHONG/releases/download/v1.0/data2.csv
          echo "‚úÖ Dataset downloaded:"
          ls -lh data/

      # 5Ô∏è‚É£ Ch·∫°y hu·∫•n luy·ªán v√† l∆∞u log
      - name: Run RF Forward training
        run: |
          mkdir -p results/logs
          echo "üîπ Running training on data2.csv"
          python train_rf_sliding.py --input data/data2.csv > results/logs/run_data2.txt 2>&1
          zip -r results_data2.zip results || true

      # 6Ô∏è‚É£ T·∫°o tag & release k·∫øt qu·∫£
      - name: Create release and upload results
        uses: softprops/action-gh-release@v2
        with:
          tag_name: auto-v${{ github.run_id }}
          name: "Auto Release (Run ${{ github.run_id }})"
          files: |
            results_data2.zip
            results/logs/run_data2.txt
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
